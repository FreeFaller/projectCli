{"version":3,"sources":["webpack:///./src/views/permision/About.vue?5987","webpack:///./src/directive/permission/permission.js","webpack:///./src/directive/permission/index.js","webpack:///./src/utils/request.js","webpack:///./src/api/about.js","webpack:///src/views/permision/About.vue","webpack:///./src/views/permision/About.vue?9478","webpack:///./src/views/permision/About.vue"],"names":["ref","index","getRoles","vnode","GlobalApp","context","userInfo","role","appNode","$root","$children","inserted","el","binding","_uid","node","document","createComment","flag","parentNode","roles","value","Array","length","permissionRoles","hasPermission","some","includes","insertBefore","removeChild","Error","unbind","install","Vue","directive","permission","window","use","TIMEOUT","baseUrl","axios","axiosFactory","create","errorHandler","res","message","toast","fail","Promise","reject","interceptors","request","config","url","timeout","error","data","retCode","retDesc","response","code","resolve","ajax","methods","forEach","m","params","Object","assign","t","Date","getTime","headers","getList","get"],"mappings":"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","file":"js/chunks/permision.e2bf889e.js","sourcesContent":["var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"div\",\n    { staticClass: \"about\" },\n    [\n      _c(\"Button\", [_vm._v(\"所有人可见\")]),\n      _vm._v(\" \"),\n      _c(\n        \"RadioGroup\",\n        {\n          directives: [\n            {\n              name: \"permission\",\n              rawName: \"v-permission\",\n              value: [_vm.Admin],\n              expression: \"[Admin]\"\n            }\n          ],\n          attrs: { type: \"button\" }\n        },\n        [\n          _c(\n            \"Radio\",\n            {\n              directives: [\n                {\n                  name: \"permission\",\n                  rawName: \"v-permission\",\n                  value: [_vm.Admin],\n                  expression: \"[Admin]\"\n                }\n              ],\n              attrs: { label: \"large\" }\n            },\n            [_vm._v(\"仅Admin可见\")]\n          ),\n          _vm._v(\" \"),\n          _c(\"Radio\", { attrs: { label: \"default\" } }, [_vm._v(\"Default\")]),\n          _vm._v(\" \"),\n          _c(\"Radio\", { attrs: { label: \"small\" } }, [_vm._v(\"small\")])\n        ],\n        1\n      ),\n      _vm._v(\" \"),\n      _c(\n        \"Button\",\n        {\n          directives: [\n            {\n              name: \"permission\",\n              rawName: \"v-permission\",\n              value: [_vm.Admin],\n              expression: \"[Admin]\"\n            }\n          ],\n          attrs: { type: \"primary\" }\n        },\n        [_vm._v(\"仅Admin可见\")]\n      ),\n      _vm._v(\" \"),\n      _c(\"h1\", { staticStyle: { \"margin-bottom\": \"30px\" } }, [\n        _vm._v(\"当前权限：\" + _vm._s(_vm.GlobalApp.userInfo.role))\n      ])\n    ],\n    1\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","let ref = {}\nlet index = 0\n//获取用户权限\nfunction getRoles(vnode) {\n  if (!vnode) {\n    return [];\n  }\n  const { GlobalApp } = vnode.context;\n  if (GlobalApp && GlobalApp.userInfo) {\n    return GlobalApp.userInfo.role || [];\n  } else {\n    const appNode = vnode.context.$root.$children[0];\n    if (appNode && appNode.userInfo) {\n      return appNode.userInfo.role || [];\n    } else {\n      return [];\n    }\n  }\n}\nexport default {\n  inserted(el, binding, vnode) {\n    const _uid = index\n    index++\n    ref[_uid] = {\n      node: document.createComment('v-permission'),\n      flag:false,\n      parentNode: el.parentNode,\n    }\n    el._uid = _uid\n    const roles = getRoles(vnode);\n    const { value } = binding;\n    if (value && value instanceof Array && value.length > 0) {\n      const permissionRoles = value;\n      const hasPermission = roles.some(role => {\n        return permissionRoles.includes(role);\n      });\n      // 对无权限的节点进行删除和标记\n      if (!hasPermission) {\n        el.parentNode.insertBefore(ref[_uid].node, el);\n        el.parentNode && el.parentNode.removeChild(el);\n        ref[_uid].flag = true\n      }\n    } else {\n      throw new Error(`need roles! Like v-permission=\"['admin','readonly']\"`);\n    }\n  },\n  // update(el, binding, vnode){\n  //   const _uid = el._uid\n  //   const roles = getRoles(vnode)\n  //   const { value } = binding\n  //   if (value && value instanceof Array && value.length > 0) {\n  //     const permissionRoles = value\n  //     const hasPermission = roles.some(role => {\n  //       return permissionRoles.includes(role)\n  //     })\n  //     const permissionFlag = ref[_uid].flag\n  //     if (!hasPermission) {\n  //       // 无权限且未被标记过时，进行节点删除和标记\n  //       if (!permissionFlag) {\n  //         el.parentNode.insertBefore(ref[_uid].node, el);\n  //         el.parentNode && el.parentNode.removeChild(el)\n  //         ref[_uid].flag = true\n  //       }\n  //     } else {\n  //       //有权限且有标记过的位置才做节点还原和删除标记\n  //       if (permissionFlag) {\n  //         ref[_uid].parentNode.insertBefore(el, ref[_uid].node);\n  //         ref[_uid].parentNode.removeChild(ref[_uid].node, el);\n  //       }\n  //     }\n  //   } else {\n  //     throw new Error(`need roles! Like v-permission=\"['admin','readonly']\"`)\n  //   }\n  // },\n  unbind(el){\n    const _uid = el._uid\n    // console.log(_uid)\n    delete ref._uid\n  }\n};\n","import permission from \"./permission\";\n\nconst install = function(Vue) {\n  Vue.directive(\"permission\", permission);\n};\n\nif (window.Vue) {\n  window[\"permission\"] = permission;\n  Vue.use(install); // eslint-disable-line\n}\n\npermission.install = install;\nexport default permission;\n","/*\r\n * --------------------------------------------\r\n * 通用发送请求文件\r\n * 默认返回json结构\r\n * - retCode : 返回码  默认200为成功，其他失败\r\n * - retDesc : 返回信息\r\n * - result : 返回信息结构体，必须为Object\r\n * --------------------------------------------\r\n */\r\nimport axiosFactory from \"axios\";\r\nimport Vue from \"vue\";\r\n\r\nconst TIMEOUT = 10000,\r\n  baseUrl = \"/\";\r\n\r\n// 新建axios实例，避免污染全局axios\r\nconst axios = axiosFactory.create({});\r\n// 错误处理通用方法\r\nconst errorHandler = function (res, message) {\r\n  // 抛出错误\r\n  if (message) {\r\n    Vue.toast.fail(`请求失败：${message}`);\r\n  }\r\n  return Promise.reject(res);\r\n};\r\n\r\n// 请求拦截器\r\naxios.interceptors.request.use(\r\n  config => {\r\n    config.url = baseUrl + config.url;\r\n    config.timeout || (config.timeout = TIMEOUT);\r\n\r\n    return config;\r\n  },\r\n  error => {\r\n    let { message } = error;\r\n    return errorHandler(\r\n      {\r\n        config: error.config,\r\n        data: {\r\n          retCode: -2,\r\n          retDesc: `请求错误：${message}`\r\n        }\r\n      },\r\n      message\r\n    );\r\n  }\r\n);\r\n\r\n// 返回拦截器\r\naxios.interceptors.response.use(\r\n  res => {\r\n    let data = res.data;\r\n    let { message } = data;\r\n\r\n    if (data.code == \"200\" || data.code == \"10200\") {\r\n      return Promise.resolve(data.data);\r\n    } else {\r\n      return errorHandler(res, message);\r\n    }\r\n  },\r\n  error => {\r\n    let { response } = error;\r\n    let message = response.data.message || \"\";\r\n    // 超时等其他catch到的错误\r\n    return errorHandler(\r\n      {\r\n        config: error.config,\r\n        data: {\r\n          retCode: -1,\r\n          retDesc: `请求失败：${message}`,\r\n          code: response.data.code\r\n        }\r\n      },\r\n      message\r\n    );\r\n  }\r\n);\r\n\r\nlet ajax = {},\r\n  methods = [\"get\", \"post\", \"delete\", \"put\"];\r\n\r\nmethods.forEach(m => {\r\n  /**\r\n   * 参数说明\r\n   * 降低修改成本，url和data参数保持原样\r\n   * 其他所有参数改成解构，需要其他参数自行添加\r\n   * =>timeout  number  超时时间  默认10s\r\n   */\r\n  ajax[m] = function (url, data = {}, { timeout = 10000 } = {}) {\r\n    let config = {\r\n      timeout\r\n    };\r\n    // post和其他method区分\r\n    if (m !== \"post\" && m !== \"put\") {\r\n      // 获取一个副本，避免修改data时影响传入的参数对象\r\n      let params = Object.assign({}, data);\r\n      // 非post请求 追加时间戳参数\r\n      params.t = new Date().getTime();\r\n      config.params = params;\r\n      return axios[m](url, config);\r\n    } else {\r\n      // post请求 追加header\r\n      config.headers = {\r\n        \"Content-Type\": \"application/json\"\r\n      };\r\n      return axios[m](url, data, config);\r\n    }\r\n  };\r\n});\r\n\r\nexport default ajax;\r\n","import request from '@/utils/request'\n\nexport function getList(params) {\n    return request.get('api/clusters/list', params);\n}","<template>\n  <div class=\"about\">\n    <Button>所有人可见</Button>\n    <RadioGroup type=\"button\" v-permission=\"[Admin]\">\n      <Radio label=\"large\" v-permission=\"[Admin]\">仅Admin可见</Radio>\n      <Radio label=\"default\">Default</Radio>\n      <Radio label=\"small\">small</Radio>\n    </RadioGroup>\n    <Button type=\"primary\" v-permission=\"[Admin]\">仅Admin可见</Button>\n    <h1 style=\"margin-bottom:30px\">当前权限：{{ GlobalApp.userInfo.role }}</h1>\n  </div>\n</template>\n<script>\nimport { Admin, Read } from \"@/utils/macro\";\nimport permission from \"@/directive/permission\";\nimport * as service from \"@/api/about\"\n\nexport default {\n  inject: [\"GlobalApp\"],\n  directives: {\n    permission\n  },\n  data() {\n    return {\n      Admin,\n      Read\n    };\n  },\n  methods:{\n    getData(){\n      service.getList({\n        a:0,\n        b:'sss'\n      }).then((data)=>{\n\n      })\n    }\n  },\n  mounted() {\n    this.getData()\n  }\n};\n</script>\n","import mod from \"-!../../../node_modules/babel-loader/lib/index.js??ref--0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./About.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js??ref--0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./About.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./About.vue?vue&type=template&id=6003aea2&\"\nimport script from \"./About.vue?vue&type=script&lang=js&\"\nexport * from \"./About.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/Users/freefaller/workspace/advanced/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('6003aea2')) {\n      api.createRecord('6003aea2', component.options)\n    } else {\n      api.reload('6003aea2', component.options)\n    }\n    module.hot.accept(\"./About.vue?vue&type=template&id=6003aea2&\", function () {\n      api.rerender('6003aea2', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/views/permision/About.vue\"\nexport default component.exports"],"sourceRoot":""}